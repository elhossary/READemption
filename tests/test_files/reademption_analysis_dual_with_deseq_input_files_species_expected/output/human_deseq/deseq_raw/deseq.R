library('DESeq2')
library('RColorBrewer')
library('gplots')
library('ggplot2')
rawCountTable <- read.table('a_test_project/output/human_gene_quanti_combined/gene_wise_quantifications_combined.csv', skip=1, sep='\t', quote='', comment.char='', colClasses=c(rep('character',10), rep('numeric',15)))
countTable <- round(rawCountTable[,11:length(names(rawCountTable))])
colnames(countTable) <- c('Co_culture_replicate_1','Co_culture_replicate_2','Co_culture_replicate_3','Harboring_replicate_1','Harboring_replicate_2','Harboring_replicate_3','Infected_replicate_1','Infected_replicate_2','Infected_replicate_3','Steady_state_replicate_1','Steady_state_replicate_2','Steady_state_replicate_3','Uninfected_replicate_1','Uninfected_replicate_2','Uninfected_replicate_3')
# Select only the libraries of this species
countTable <- countTable[, c('Co_culture_replicate_1','Co_culture_replicate_2','Co_culture_replicate_3','Harboring_replicate_1','Harboring_replicate_2','Harboring_replicate_3','Infected_replicate_1','Infected_replicate_2','Infected_replicate_3','Uninfected_replicate_1','Uninfected_replicate_2','Uninfected_replicate_3')]
libs <- c('Co_culture_replicate_1','Co_culture_replicate_2','Co_culture_replicate_3','Harboring_replicate_1','Harboring_replicate_2','Harboring_replicate_3','Infected_replicate_1','Infected_replicate_2','Infected_replicate_3','Uninfected_replicate_1','Uninfected_replicate_2','Uninfected_replicate_3')
conds <- c('co_culture', 'co_culture', 'co_culture', 'harboring', 'harboring', 'harboring', 'infected', 'infected', 'infected', 'uninfected', 'uninfected', 'uninfected')
reps <- c('1', '2', '3', '1', '2', '3', '1', '2', '3', '1', '2', '3')
samples <- data.frame(row.names=libs, condition=conds, lib=libs, replicate=reps)
dds <- DESeqDataSetFromMatrix(countData=countTable, colData=samples, design=~condition)
dds <- DESeq(dds, betaPrior=TRUE)

# PCA plot
pdf('a_test_project/output/human_deseq/deseq_raw/sample_comparison_pca_heatmap.pdf')
rld <- rlog(dds)
pcaData <- plotPCA(rld, 'condition', intgroup=c('condition', 'replicate'), returnData=TRUE)
percentVar <- round(100 * attr(pcaData, 'percentVar'))
print(ggplot(pcaData, aes(PC1, PC2, color=condition, shape=replicate)) +
geom_point(size=3) +
xlab(paste0('PC1: ',percentVar[1],'% variance')) +
ylab(paste0('PC2: ',percentVar[2],'% variance')) +
coord_fixed())
# Heatmap
distsRL <- dist(t(assay(rld)))
mat <- as.matrix(distsRL)
rownames(mat) <- with(colData(dds), paste(lib, sep=' : '))
hmcol <- colorRampPalette(brewer.pal(9, 'GnBu'))(100)
heatmap.2(mat, trace='none', col = rev(hmcol), margin=c(13, 13))
comp0 <- results(dds, contrast=c('condition','co_culture', 'harboring'))
write.table(comp0, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_co_culture_vs_harboring.csv', quote=FALSE, sep='\t')
comp1 <- results(dds, contrast=c('condition','co_culture', 'infected'))
write.table(comp1, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_co_culture_vs_infected.csv', quote=FALSE, sep='\t')
comp2 <- results(dds, contrast=c('condition','co_culture', 'uninfected'))
write.table(comp2, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_co_culture_vs_uninfected.csv', quote=FALSE, sep='\t')
comp3 <- results(dds, contrast=c('condition','harboring', 'co_culture'))
write.table(comp3, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_harboring_vs_co_culture.csv', quote=FALSE, sep='\t')
comp4 <- results(dds, contrast=c('condition','harboring', 'infected'))
write.table(comp4, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_harboring_vs_infected.csv', quote=FALSE, sep='\t')
comp5 <- results(dds, contrast=c('condition','harboring', 'uninfected'))
write.table(comp5, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_harboring_vs_uninfected.csv', quote=FALSE, sep='\t')
comp6 <- results(dds, contrast=c('condition','infected', 'co_culture'))
write.table(comp6, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_infected_vs_co_culture.csv', quote=FALSE, sep='\t')
comp7 <- results(dds, contrast=c('condition','infected', 'harboring'))
write.table(comp7, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_infected_vs_harboring.csv', quote=FALSE, sep='\t')
comp8 <- results(dds, contrast=c('condition','infected', 'uninfected'))
write.table(comp8, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_infected_vs_uninfected.csv', quote=FALSE, sep='\t')
comp9 <- results(dds, contrast=c('condition','uninfected', 'co_culture'))
write.table(comp9, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_uninfected_vs_co_culture.csv', quote=FALSE, sep='\t')
comp10 <- results(dds, contrast=c('condition','uninfected', 'harboring'))
write.table(comp10, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_uninfected_vs_harboring.csv', quote=FALSE, sep='\t')
comp11 <- results(dds, contrast=c('condition','uninfected', 'infected'))
write.table(comp11, file='a_test_project/output/human_deseq/deseq_raw/deseq_comp_uninfected_vs_infected.csv', quote=FALSE, sep='\t')
